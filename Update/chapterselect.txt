
void main()
{

	DrawSceneWithMask( "black", "2", 0, 0, 500 );

	Wait(500);

	DrawScene("scenario_a", 500);

	DrawSceneWithMask( "scenario_select", "5", 0, 0, 500 );

	//EnableJumpingOfReturnIcon();

	OutputLine(NULL, "",
		   NULL, "", Line_ContinueAfterTyping);
	ClearMessage();

	char Chapter[6];

	if(GetGlobalFlag(GLanguage) == 1)
	{
		Chapter[0] = "Taraimawashi";
		Chapter[1] = "Tsukiotoshi";
		Chapter[2] = "Someutsushi";
		Chapter[3] = "Kageboushi";
		Chapter[4] = "Yoigoshi";		
		Chapter[5] = "Back";

		//Chapter[6] = "Tokihogushi";
		//Chapter[7] = "Miotsukushi Omote";
		//Chapter[8] = "Miotsukushi Ura";
		//Chapter[9] = "Kotohogushi";
		//Chapter[10] = "Hajisarashi";

	}
	else
	{
		Chapter[0] = "盥回し編";
		Chapter[1] = "憑落し編";
		Chapter[2] = "染伝し編";
		Chapter[3] = "影紡し編";
		Chapter[4] = "宵越し編";		
		Chapter[5] = "戻る";

		//Chapter[6] = "解々し編";
		//Chapter[7] = "澪尽し編 表";
		//Chapter[8] = "澪尽し編 裏";
		//Chapter[9] = "言祝し編";
		//Chapter[10] = "羞晒し編";

	}

//	InitializeSelectedItem();
	Select( 6, Chapter );
	DisableWindow();
	if(LoadValueFromLocalWork( SelectResult ) == 0)
	{
		DrawScene( "scenario/taraimawashi_a", 500 );
		DrawSceneWithMask( "scenario/taraimawashi_b", "5", 0, 0, 500 );
		DrawSceneWithMask( "scenario/taraimawashi_c", "5", 0, 0, 500 );

		ShowChapterPreview();

		if(LoadValueFromLocalWork( LOCALWORK_NO_RESULT ) == 1)
		{
			StopBGM( 2 );
			PlaySE( 1, "wa_037", 128, 64 );

			SetValidityOfSaving( TRUE );
			CallSection("TaraiDay1");
		}
		else
		{
			JumpScript( "flow" );
		}
	}
	else if(LoadValueFromLocalWork( SelectResult ) == 1)
	{
		DrawScene( "scenario/tsukiotoshi_a", 500 );
		DrawSceneWithMask( "scenario/tsukiotoshi_b", "5", 0, 0, 500 );
		DrawSceneWithMask( "scenario/tsukiotoshi_c", "5", 0, 0, 500 );

		ShowChapterPreview();

		if(LoadValueFromLocalWork( LOCALWORK_NO_RESULT ) == 1)
		{
			StopBGM( 2 );
			PlaySE( 1, "wa_037", 128, 64 );

			SetValidityOfSaving( TRUE );
			CallSection("TsukiDay1");
		}
		else
		{
			JumpScript( "flow" );
		}
	}
	else if(LoadValueFromLocalWork( SelectResult ) == 2)
	{
		DrawScene( "scenario/someutsushi_a", 500 );
		DrawSceneWithMask( "scenario/someutsushi_b", "5", 0, 0, 500 );
		DrawSceneWithMask( "scenario/someutsushi_c", "5", 0, 0, 500 );

		ShowChapterPreview();

		if(LoadValueFromLocalWork( LOCALWORK_NO_RESULT ) == 1)
		{
			StopBGM( 2 );
			PlaySE( 1, "wa_037", 128, 64 );

			SetValidityOfSaving( TRUE );
			CallSection("SomeDay1");
		}
		else
		{
			JumpScript( "flow" );
		}
	}
	else if(LoadValueFromLocalWork( SelectResult ) == 3)
	{
		DrawScene( "scenario/kageboushi_a", 500 );
		DrawSceneWithMask( "scenario/kageboushi_b", "5", 0, 0, 500 );
		DrawSceneWithMask( "scenario/kageboushi_c", "5", 0, 0, 500 );

		ShowChapterPreview();

		if(LoadValueFromLocalWork( LOCALWORK_NO_RESULT ) == 1)
		{
			StopBGM( 2 );
			PlaySE( 1, "wa_037", 128, 64 );

			SetValidityOfSaving( TRUE );
			CallSection("KageDay1");
		}
		else
		{
			JumpScript( "flow" );
		}
	}
		else if(LoadValueFromLocalWork( SelectResult ) == 4)
	{
		DrawScene( "scenario/kageboushi_a", 500 );
		DrawSceneWithMask( "scenario/kageboushi_b", "5", 0, 0, 500 );
		DrawSceneWithMask( "scenario/kageboushi_c", "5", 0, 0, 500 );

		ShowChapterPreview();

		if(LoadValueFromLocalWork( LOCALWORK_NO_RESULT ) == 1)
		{
			StopBGM( 2 );
			PlaySE( 1, "wa_037", 128, 64 );

			SetValidityOfSaving( TRUE );
			CallSection("YoiDay1");
		}
		else
		{
			JumpScript( "flow" );
		}
	}
	else
	{
		StopBGM( 2 );
		DisableWindow();
		DrawScene("black", 500);
		JumpScript( "flow" );
	}

}

void SetDay()
{
	int chapter;
	chapter = LoadValueFromLocalWork( ChapterNumber );

	SetLocalFlag(LHimatsubushiDay, chapter);

	if(GetGlobalFlag(GHimatsubushiDay) < chapter)
		SetGlobalFlag(GHimatsubushiDay, chapter);
}

void ViewTips()
{
	StoreValueToLocalWork( TipsMode , 2 );

	CallSection("ViewTipsDisplay");
}

void ViewTipsDisplay()
{
	//uses local flag TipsMode to determine what happens
	//0 - Leave, 1 - Show Extras Menu, 2 - Show Mid Chapter Screen, 3 - Show New Tips, 4 - Show All Tips (Local), 5 - Show All Tips (Global)

	SetValidityOfSaving( TRUE );

	DisableWindow();

	if(LoadValueFromLocalWork( TipsMode ) < 3)
		DrawScene("black", 0);

	if(LoadValueFromLocalWork( TipsMode ) == 1)
		ShowExtras();

	if(LoadValueFromLocalWork( TipsMode ) == 2)
		ShowChapterScreen();

	if(LoadValueFromLocalWork( TipsMode ) > 2)
	{
		ShowTips(LoadValueFromLocalWork( TipsMode ) - 3);
		CheckTipsAchievements();
	}

	if(LoadValueFromLocalWork( LOCALWORK_NO_RESULT ) > 0)
		CallSection("ViewTipsDisplay");
}

void SomeDay1()
{
	CallScript( "some_001" );
	JumpSection("SomeDay2");
}

void SomeDay2()
{
	CallScript( "some_002" );
	JumpSection("SomeDay3");
}

void SomeDay3()
{
	CallScript( "some_003" );

	SetLocalFlag(GArc, 2);
	StoreValueToLocalWork( ChapterNumber, 3 );
	SavePoint("Ch.3 終わり", "End of Chapter 3");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("SomeDay4");
}

void SomeDay4()
{
	CallScript( "some_004" );
	JumpSection("SomeDay5");
}

void SomeDay5()
{
	CallScript( "some_005" );
	JumpSection("SomeDay6");
}

void SomeDay6()
{
	CallScript( "some_006" );

	SetLocalFlag(GArc, 2);
	StoreValueToLocalWork( ChapterNumber, 6 );
	SavePoint("Ch.6 終わり", "End of Chapter 6");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("SomeDay7");
}

void SomeDay7()
{
	CallScript( "some_007" );

	SetLocalFlag(GArc, 2);
	StoreValueToLocalWork( ChapterNumber, 7 );
	SavePoint("Ch.7 終わり", "End of Chapter 7");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("SomeDay8");
}

void SomeDay8()
{
	CallScript( "some_008" );
	JumpSection("SomeDay9");
}

void SomeDay9()
{
	CallScript( "some_009" );

	SetLocalFlag(GArc, 2);
	StoreValueToLocalWork( ChapterNumber, 9 );
	SavePoint("Ch.9 終わり", "End of Chapter 9");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("SomeDay10");
}

void SomeDay10()
{
	CallScript( "some_010" );
	JumpSection("SomeDay11");
}

void SomeDay11()
{
	CallScript( "some_011" );
	JumpSection("SomeDay12");
}

void SomeDay12()
{
	CallScript( "some_012" );
	JumpSection("SomeDay13");
}

void SomeDay13()
{
	CallScript( "some_013" );
	JumpSection("SomeDay14");
}

void SomeDay14()
{
	CallScript( "some_014" );

	SetLocalFlag(GArc, 2);
	StoreValueToLocalWork( ChapterNumber, 14 );
	SavePoint("Ch.14 終わり", "End of Chapter 14");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpScript( "flow" );
}

void KageDay1()
{
	CallScript( "kage_001" );

	SetLocalFlag(GArc, 3);
	StoreValueToLocalWork( ChapterNumber, 1 );
	SavePoint("Ch.1 終わり", "End of Chapter 1");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("KageDay2");
}

void KageDay2()
{
	CallScript( "kage_002" );

	SetLocalFlag(GArc, 3);
	StoreValueToLocalWork( ChapterNumber, 2 );
	SavePoint("Ch.2 終わり", "End of Chapter 2");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("KageDay3");
}

void KageDay3()
{
	CallScript( "kage_003" );

	SetLocalFlag(GArc, 3);
	StoreValueToLocalWork( ChapterNumber, 3 );
	SavePoint("Ch.3 終わり", "End of Chapter 3");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("KageDay4");
}

void KageDay4()
{
	CallScript( "kage_004" );

	SetLocalFlag(GArc, 3);
	StoreValueToLocalWork( ChapterNumber, 4 );
	SavePoint("Ch.4 終わり", "End of Chapter 4");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("KageDay5");
}

void KageDay5()
{
	CallScript( "kage_005" );
	JumpSection("KageDay6");
}

void KageDay6()
{
	CallScript( "kage_006" );
	JumpSection("KageDay7");
}

void KageDay7()
{
	CallScript( "kage_007" );

	SetLocalFlag(GArc, 3);
	StoreValueToLocalWork( ChapterNumber, 7 );
	SavePoint("Ch.7 終わり", "End of Chapter 7");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("KageDay8");
}

void KageDay8()
{
	CallScript( "kage_008" );
	JumpSection("KageDay9");
}

void KageDay9()
{
	CallScript( "kage_009" );
	JumpSection("KageDay10");
}

void KageDay10()
{
	CallScript( "kage_010" );
	JumpSection("KageDay11");
}

void KageDay11()
{
	CallScript( "kage_011" );

	SetLocalFlag(GArc, 3);
	StoreValueToLocalWork( ChapterNumber, 11 );
	SavePoint("Ch.11 終わり", "End of Chapter 11");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("KageDay12");
}

void KageDay12()
{
	CallScript( "kage_012" );

	SetLocalFlag(GArc, 3);
	StoreValueToLocalWork( ChapterNumber, 12 );
	SavePoint("Ch.12 終わり", "End of Chapter 12");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpScript( "flow" );
}

void TsukiDay1()
{
	CallScript( "tsuk_001" );
	JumpSection("TsukiDay2");
}

void TsukiDay2()
{
	CallScript( "tsuk_002" );
	JumpSection("TsukiDay3");
}

void TsukiDay3()
{
	CallScript( "tsuk_003" );
	JumpSection("TsukiDay4");
}

void TsukiDay4()
{
	CallScript( "tsuk_004" );
	JumpSection("TsukiDay5");
}

void TsukiDay5()
{
	CallScript( "tsuk_005" );
	JumpSection("TsukiDay6");
}

void TsukiDay6()
{
	CallScript( "tsuk_006" );
	JumpSection("TsukiDay7");
}

void TsukiDay7()
{
	CallScript( "tsuk_007" );
	JumpSection("TsukiDay8");
}

void TsukiDay8()
{
	CallScript( "tsuk_008" );
	JumpSection("TsukiDay9");
}

void TsukiDay9()
{
	CallScript( "tsuk_009" );
	JumpSection("TsukiDay10");
}

void TsukiDay10()
{
	CallScript( "tsuk_010" );
	JumpSection("TsukiDay11");
}

void TsukiDay11()
{
	CallScript( "tsuk_011" );
	JumpSection("TsukiDay12");
}

void TsukiDay12()
{
	CallScript( "tsuk_012" );
	JumpSection("TsukiDay13");
}

void TsukiDay13()
{
	CallScript( "tsuk_013" );
	JumpSection("TsukiDay14");
}

void TsukiDay14()
{
	CallScript( "tsuk_014" );
	JumpSection("TsukiDay15");
}

void TsukiDay15()
{
	CallScript( "tsuk_015" );
	JumpSection("TsukiDay16");
}

void TsukiDay16()
{
	CallScript( "tsuk_016" );
	JumpScript( "flow" );
}


void TaraiDay1()
{
	CallScript( "tara_001" );

	SetLocalFlag(GArc, 0);
	StoreValueToLocalWork( ChapterNumber, 1 );
	SavePoint("Ch.1 終わり", "End of Chapter 1");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("TaraiDay2");
}

void TaraiDay2()
{
	CallScript( "tara_002" );
	JumpSection("TaraiDay3");
}

void TaraiDay3()
{
	CallScript( "tara_003" );
	JumpSection("TaraiDay4");
}

void TaraiDay4()
{
	CallScript( "tara_004" );
	JumpSection("TaraiDay5");
}

void TaraiDay5()
{
	CallScript( "tara_005" );
	JumpSection("TaraiDay6");
}

void TaraiDay6()
{
	CallScript( "tara_006" );
	JumpSection("TaraiDay7");
}

void TaraiDay7()
{
	CallScript( "tara_007" );
	JumpSection("TaraiDay8");
}

void TaraiDay8()
{
	CallScript( "tara_008" );
	JumpSection("TaraiDay9");
}

void TaraiDay9()
{
	CallScript( "tara_009" );

	SetLocalFlag(GArc, 0);
	StoreValueToLocalWork( ChapterNumber, 9 );
	SavePoint("Ch.9 終わり", "End of Chapter 9");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpScript( "flow" );
}

void YoiDay1()
{
	CallScript( "yoig_001" );

	SetLocalFlag(GArc, 4);
	StoreValueToLocalWork( ChapterNumber, 1 );
	SavePoint("Ch.1 終わり", "End of Chapter 1");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("YoiDay2");
}

void YoiDay2()
{
	CallScript( "yoig_002" );

	SetLocalFlag(GArc, 4);
	StoreValueToLocalWork( ChapterNumber, 2 );
	SavePoint("Ch.2 終わり", "End of Chapter 2");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("YoiDay3");
}

void YoiDay3()
{
	CallScript( "yoig_003" );

	SetLocalFlag(GArc, 4);
	StoreValueToLocalWork( ChapterNumber, 3 );
	SavePoint("Ch.3 終わり", "End of Chapter 3");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("YoiDay4");
}

void YoiDay4()
{
	CallScript( "yoig_004" );

//	char Choice1[2];

//	if(GetGlobalFlag(GLanguage) == 1)
//	{
//		Choice1[0] = "Taraimawashi";
//		Choice1[1] = "Tsukiotoshi";
//	}
//	else
//	{
//		Choice1[0] = "盥回し編";
//		Choice1[1] = "憑落し編";
//	}

//	InitializeSelectedItem();
//	Select( 2, Choice1 );
//	DisableWindow();
//	if (LoadValueFromLocalWork( SelectResult ) == 0) 
//	{
//		CallScript("yoig_route_a");
//		JumpSection("YoiDay4_to5");
//		SetGlobalFlag(GHimatsubushiDay, 0);
//	}
//	else 
//	{
//		CallScript("yoig_route_b");
//		JumpSection("YoiDay4_to5b");
//		SetGlobalFlag(GHimatsubushiDay, 1);
//	}
	
	if (GetGlobalFlag(GHimatsubushiDay) == 0) 
	{
		CallScript("yoig_route_a");
//		JumpSection("YoiDay5");
	}
	else 
	{
		CallScript("yoig_route_b");
		JumpSection("YoiDay5b");
	}
}

void YoiDay5()
{
	CallScript( "yoig_005" );

	SetLocalFlag(GArc, 4);
	StoreValueToLocalWork( ChapterNumber, 5 );
	SavePoint("Ch.5 終わり", "End of Chapter 5");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("YoiDay6");
}

void YoiDay5b()
{
	CallScript( "yoig_005b" );

	if (GetGlobalFlag(GHimatsubushiDay) == 0) 
	{
		JumpSection("YoiDay6b");
	}
	else {
		JumpSection("YoiBadEnd3");
	}
}

void YoiDay6()
{
	CallScript( "yoig_006" );

	if (GetGlobalFlag(GHimatsubushiDay) == 0) 
	{
		JumpSection("YoiDay7");
	}
	else {
		JumpSection("YoiBadEnd1");
	}
}

void YoiDay6b()
{
	CallScript( "yoig_006b" );
	JumpSection("YoiDay7b");
}

void YoiBadEnd3()
{
	CallScript( "yoig_badend3" );
	JumpScript( "flow" );
}

void YoiDay7()
{
	CallScript( "yoig_007" );

	SetLocalFlag(GArc, 4);
	StoreValueToLocalWork( ChapterNumber, 7 );
	SavePoint("Ch.7 終わり", "End of Chapter 7");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("YoiDay8");
}

void YoiBadEnd1()
{
	CallScript( "yoig_badend1" );
	JumpScript( "flow" );
}

void YoiDay7b()
{
	CallScript( "yoig_007b" );

	SetLocalFlag(GArc, 4);
	StoreValueToLocalWork( ChapterNumber, 8 );
	SavePoint("Ch.7b 終わり", "End of Chapter 7b");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpSection("YoiBadEnd2");
}

void YoiDay8()
{
	CallScript( "yoig_008" );
	JumpSection("YoiDay9");
}

void YoiBadEnd2()
{
	CallScript( "yoig_badend2" );
	JumpScript( "flow" );
}

void YoiDay9()
{
	CallScript( "yoig_009" );
	JumpSection("YoiDay10");
}

void YoiDay10()
{
	CallScript( "yoig_010" );
	JumpSection("YoiDay11");
}

void YoiDay11()
{
	CallScript( "yoig_011" );
	JumpSection("YoiDay12");
}

void YoiDay12()
{
	CallScript( "yoig_012" );
	JumpSection("YoiDay13");
}

void YoiDay13()
{
	CallScript( "yoig_013" );
	JumpSection("YoiDay14");
}

void YoiDay14()
{
	CallScript( "yoig_014" );

	SetLocalFlag(GArc, 4);
	StoreValueToLocalWork( ChapterNumber, 14 );
	SavePoint("Ch.14 終わり", "End of Chapter 14");
	CallSection( "SetDay" );
	CallSection( "ViewTips" );

	JumpScript( "flow" );
}